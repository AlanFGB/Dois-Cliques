import React, { useState, useEffect } from 'react';
import { 
  Shield, 
  MapPin, 
  Mic, 
  Leaf, 
  Moon, 
  Zap, 
  MessageSquare,
  AlertCircle,
  CheckCircle2
} from 'lucide-react';

/**
 * PROJETO: Dois Cliques
 * LICENÇA: MIT
 * FOCO: Segurança, Sustentabilidade e Qualidade.
 * * Este ficheiro serve como o componente principal (App) para a sua aplicação.
 */

const App = () => {
  const [stage, setStage] = useState('home'); 
  const [timer, setTimer] = useState(3);
  const [ecoMode, setEcoMode] = useState(true);
  const [isRecording, setIsRecording] = useState(false);

  // Lógica de contagem decrescente para o alerta de emergência
  useEffect(() => {
    let interval;
    if (stage === 'alerting' && timer > 0) {
      interval = setInterval(() => setTimer(t => t - 1), 1000);
    } else if (stage === 'alerting' && timer === 0) {
      setStage('active');
    }
    return () => clearInterval(interval);
  }, [stage, timer]);

  // Definição da paleta de cores baseada no Modo Eco (Sustentabilidade)
  const colors = {
    bg: ecoMode ? 'bg-slate-950' : 'bg-white',
    text: ecoMode ? 'text-slate-50' : 'text-slate-900',
    accent: 'text-emerald-500',
    accentBg: 'bg-emerald-500',
    card: ecoMode ? 'bg-slate-900 border-slate-800' : 'bg-slate-50 border-slate-200'
  };

  // Ecrã de Alerta Ativo (Contagem Decrescente)
  if (stage === 'alerting') {
    return (
      <div className="flex flex-col items-center justify-center h-full bg-emerald-900 text-white p-6 text-center animate-in fade-in duration-300">
        <AlertCircle size={48} className="mb-6 animate-pulse" />
        <h2 className="text-xl font-bold tracking-widest uppercase mb-12">Dois Cliques: Acionando...</h2>
        <div className="text-9xl font-black mb-16 tabular-nums">{timer}</div>
        <button 
          onClick={() => { setStage('home'); setTimer(3); }}
          className="px-12 py-4 bg-white/10 backdrop-blur-md border border-white/20 rounded-full font-bold text-lg active:scale-95 transition-all"
        >
          CANCELAR
        </button>
      </div>
    );
  }

  return (
    <div className={`flex flex-col h-[750px] max-w-md mx-auto overflow-hidden shadow-2xl transition-colors duration-500 ${colors.bg}`}>
      {/* Barra de Ferramentas Superior */}
      <div className="p-6 flex justify-between items-center z-10">
        <div className="flex items-center space-x-2">
          <Leaf className="text-emerald-500" size={18} />
          <span className={`text-[10px] font-black uppercase tracking-widest ${colors.text} opacity-50`}>
            Dois Cliques • Eco-Mode
          </span>
        </div>
        <button 
          onClick={() => setEcoMode(!ecoMode)}
          className={`p-2 rounded-full transition-colors ${ecoMode ? 'bg-slate-800' : 'bg-slate-100'}`}
          title="Alternar Modo Eco"
        >
          {ecoMode ? <Zap size={20} className="text-yellow-400" /> : <Moon size={20} className="text-slate-600" />}
        </button>
      </div>

      {/* Estado Inicial: Ecrã Principal */}
      {stage === 'home' && (
        <div className="flex-1 flex flex-col items-center justify-around p-6 animate-in slide-in-from-bottom-4 duration-500">
          <div className="text-center">
            <h1 className={`text-4xl font-black tracking-tighter ${colors.text} mb-2`}>DOIS CLIQUES</h1>
            <p className={`text-sm opacity-60 max-w-[220px] mx-auto ${colors.text}`}>
              Segurança rápida, sustentável e comunitária.
            </p>
          </div>

          <button 
            onClick={() => setStage('alerting')}
            className={`relative w-64 h-64 rounded-full flex items-center justify-center shadow-2xl transition-transform active:scale-90 ${colors.accentBg}`}
          >
            <div className="absolute inset-0 rounded-full bg-emerald-500 animate-ping opacity-20"></div>
            <Shield size={90} color="white" strokeWidth={1.5} />
          </button>

          <div className={`w-full p-5 rounded-3xl border flex items-center space-x-4 ${colors.card}`}>
            <div className="p-2 bg-emerald-500/20 rounded-xl">
              <MapPin className="text-emerald-500" size={24} />
            </div>
            <div className="flex-1 overflow-hidden">
              <p className="text-[10px] font-black text-emerald-500 uppercase tracking-widest">Sinal de Alta Fidelidade</p>
              <p className={`text-sm font-mono truncate ${colors.text}`}>Localização verificada via Eco-GPS</p>
            </div>
          </div>
        </div>
      )}

      {/* Estado: Emergência Ativa */}
      {stage === 'active' && (
        <div className="flex-1 flex flex-col p-6 space-y-6 animate-in fade-in duration-500">
          <div className={`p-8 rounded-[2.5rem] border flex flex-col items-center text-center shadow-lg ${colors.card}`}>
            <CheckCircle2 size={40} className="text-emerald-500 mb-4" />
            <h3 className={`text-2xl font-bold mb-2 ${colors.text}`}>Alerta Enviado</h3>
            <p className={`text-sm opacity-60 ${colors.text}`}>
              A sua posição foi enviada. Dispositivos próximos foram mapeados para apoiar a investigação.
            </p>
          </div>

          <div className="grid grid-cols-2 gap-4">
            <button onClick={() => setStage('reporting')} className={`flex flex-col items-center p-6 rounded-3xl border transition-all active:scale-95 ${colors.card}`}>
              <Mic size={32} className="text-emerald-500 mb-2" />
              <span className={`text-xs font-bold uppercase ${colors.text}`}>Relato Áudio</span>
            </button>
            <button onClick={() => setStage('reporting')} className={`flex flex-col items-center p-6 rounded-3xl border transition-all active:scale-95 ${colors.card}`}>
              <MessageSquare size={32} className="text-emerald-500 mb-2" />
              <span className={`text-xs font-bold uppercase ${colors.text}`}>Relato Texto</span>
            </button>
          </div>

          <button onClick={() => setStage('home')} className={`mt-auto w-full py-4 text-[10px] font-black uppercase tracking-[0.2em] opacity-30 ${colors.text}`}>
            Finalizar Ocorrência
          </button>
        </div>
      )}

      {/* Estado: Envio de Evidências */}
      {stage === 'reporting' && (
        <div className="flex-1 flex flex-col p-6 space-y-6 animate-in slide-in-from-right duration-300">
          <h2 className={`text-xl font-black uppercase ${colors.text}`}>Evidências</h2>
          <textarea 
            placeholder="Descreva o ocorrido..."
            className={`w-full h-40 p-5 rounded-3xl border-none outline-none resize-none transition-all ${ecoMode ? 'bg-slate-900 text-white' : 'bg-slate-100 text-slate-900'}`}
          />
          <div className={`p-10 rounded-[2.5rem] flex flex-col items-center border-2 border-dashed transition-colors ${isRecording ? 'border-red-500' : 'border-emerald-500/20'}`}>
            <button 
              onMouseDown={() => setIsRecording(true)}
              onMouseUp={() => setIsRecording(false)}
              className={`w-24 h-24 rounded-full flex items-center justify-center transition-all ${isRecording ? 'bg-red-500 scale-110' : 'bg-emerald-600'}`}
            >
              <Mic color="white" size={36} />
            </button>
            <p className={`mt-6 text-xs font-black uppercase ${isRecording ? 'text-red-500' : 'text-emerald-600'}`}>
              {isRecording ? 'Gravando...' : 'Segure para Gravar'}
            </p>
          </div>
          <button onClick={() => setStage('active')} className="w-full py-5 bg-emerald-600 text-white rounded-[1.5rem] font-black uppercase tracking-widest mt-auto shadow-lg active:scale-95 transition-transform">
            Enviar Relatório
          </button>
        </div>
      )}

      {/* Indicador de Rodapé */}
      <div className="p-2 flex justify-center">
        <div className="w-32 h-1.5 bg-slate-800 rounded-full opacity-20"></div>
      </div>
    </div>
  );
};

export default App;
